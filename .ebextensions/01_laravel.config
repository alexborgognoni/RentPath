option_settings:
  aws:elasticbeanstalk:container:php:phpini:
    memory_limit: 512M
    max_execution_time: 120

  aws:elasticbeanstalk:environment:proxy:staticfiles:
    /public: public

container_commands:
  01_composer_install:
    command: "composer install --no-dev --optimize-autoloader --no-interaction"

  02_npm_install:
    command: "npm ci --production=false --silent"

  03_npm_build:
    command: "npm run build"

  04_laravel_setup:
    command: |
      php artisan config:cache
      php artisan route:cache
      php artisan view:cache
      chmod -R 775 storage bootstrap/cache
    leader_only: true

  05_database_migrate:
    command: "php artisan migrate --force --no-interaction"
    leader_only: true